# cmb-credit-card-analysis 技能

这个技能用于分析招商银行信用卡的消费记录和月度报告。

## 核心功能

- 从本地SQLite数据库读取信用卡交易数据
- 基于**账单周期结束日期**生成月度消费报告
- 自动按类别统计消费情况(餐饮、购物、交通、高铁等)
- 生成可视化的支出分布图表
- 提供详细的交易明细列表
- **自动获取缺失数据**:如果请求月份没有数据,自动从阿里云邮箱获取

## 重要:账单周期匹配规则

**招商银行信用卡账单周期通常是上月13日至本月12日。**

本技能按**账单周期结束日期**匹配报告:

- 查询 `202511` (2025年11月) → 返回 `bill_date = 2025-11-12` 的账单
- 查询 `202512` (2025年12月) → 返回 `bill_date = 2025-12-12` 的账单

例如,当你请求"2025年11月报告"时,会返回**结束于**2025年11月12日的账单,该账单覆盖2025年10月13日至11月12日的交易。

这确保了查询月份与账单周期正确对应。

## 文件结构

- `SKILL.md` - 技能的主要描述和完整使用指南
- `scripts/query_report.py` - 月度报告生成脚本
- `scripts/fetch_bills.py` - 从邮箱获取账单数据的脚本
- `scripts/cmb_cc_assistant.py` - 账单解析和分类核心逻辑
- `scripts/alibaba_mail_helper.py` - 阿里云邮箱连接辅助工具
- `scripts/cmb_cc_bills.db` - SQLite数据库(存储账单和交易数据)

## 使用场景

当用户需要分析招商银行信用卡的特定月份消费记录时,可以调用此技能。

**示例请求:**
- "请使用cmb_credit_card_analysis技能生成2025年11月的消费报告"
- "我想查看202511月份尾号4336的招行信用卡月度支出报告"
- "分析一下我上个月的招行信用卡消费情况"

## 技术要点

- **语言**: Python 3
- **数据库**: SQLite 3
- **依赖**: 标准库(无需额外安装)
- **邮件协议**: IMAP(连接阿里云邮箱)
- **编码**: UTF-8

## 前置条件

1. **数据库位置**:
   - 路径: `skills/cmb-credit-card-analysis/scripts/cmb_cc_bills.db`

2. **环境变量**(用于自动获取数据):
   ```bash
   export ALIBABA_MAIL_USERNAME='your_email@example.com'
   export ALIBABA_MAIL_PASSWORD='your_password'
   ```

3. **Python 3** 已安装